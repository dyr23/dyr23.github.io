<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸“ä¸šå¤§è¯éª° - DYR23</title>
    <style>
        body {
            /* èƒŒæ™¯è°ƒæš—ä¸€ç‚¹ï¼Œæ›´æœ‰é…’å§/èšä¼šæ°›å›´ */
            background-color: #2c3e50; 
            font-family: "Microsoft YaHei", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* å†…å®¹é ä¸Šï¼Œç»™ä¸‹é¢ç•™æ“ä½œç©ºé—´ */
            height: 100vh;
            margin: 0;
            overflow: hidden;
            touch-action: none; /* ç¦æ­¢æµè§ˆå™¨é»˜è®¤çš„æ»šåŠ¨å’Œç¼©æ”¾ */
            perspective: 1000px; /* å¼€å¯3Dé€è§† */
        }

        h1 {
            color: #ecf0f1;
            font-size: 20px;
            margin: 20px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* æ¸¸æˆä¸»èˆå° */
        #stage {
            position: relative;
            width: 300px;
            height: 300px;
            transform-style: preserve-3d;
            /* è®©èˆå°ç¨å¾®å€¾æ–œä¸€ç‚¹ï¼Œæ›´æœ‰ç«‹ä½“æ„Ÿ */
            transform: rotateX(20deg);
            margin-top: 50px;
        }

        /* éª°å­å®¹å™¨ */
        #dice-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            position: absolute;
            bottom: 20px;
            width: 100%;
            /* éª°å­è¦åœ¨æ¯å­ä¸‹é¢ */
            z-index: 1;
        }

        /* 3Dè´¨æ„Ÿçš„éª°å­ */
        .die {
            width: 50px;
            height: 50px;
            background: #ecf0f1; /* è±¡ç‰™ç™½ */
            border-radius: 8px;
            /* åŠ ä¸Šåšé‡çš„é˜´å½±ï¼Œåˆ¶é€ ç«‹ä½“æ„Ÿ */
            box-shadow: 
                inset 0 0 5px rgba(0,0,0,0.1),
                0 5px 10px rgba(0,0,0,0.3);
            display: grid;
            grid-template: repeat(3, 1fr) / repeat(3, 1fr);
            padding: 4px;
            box-sizing: border-box;
            transition: transform 0.2s;
        }

        /* éª°å­ç‚¹æ•° */
        .dot {
            background-color: #c0392b; /* æ·±çº¢è‰²ç‚¹ */
            border-radius: 50%;
            width: 9px;
            height: 9px;
            margin: auto;
            box-shadow: inset 0 1px 1px rgba(0,0,0,0.3);
        }

        /* éª°ç›… (æ¯å­) */
        #dice-cup {
            position: absolute;
            bottom: 0; /* åˆå§‹ä½ç½®åœ¨æœ€åº•éƒ¨ç›–ä½éª°å­ */
            left: 50%;
            margin-left: -120px; /* å±…ä¸­ */
            width: 240px;
            height: 220px;
            /* ç”¨æ¸å˜è‰²æ¨¡æ‹Ÿåœ†æŸ±ä½“æ¯å­çš„ç«‹ä½“æ„Ÿ */
            background: linear-gradient(to right, #4a3121, #6d4c41, #4a3121);
            border-radius: 20px 20px 5px 5px;
            box-shadow: 
                inset 0 -5px 15px rgba(0,0,0,0.5), /* å†…éƒ¨é˜´å½± */
                0 10px 30px rgba(0,0,0,0.6); /* å¤–éƒ¨æŠ•å½± */
            z-index: 10; /* æ¯å­åœ¨æœ€ä¸Šé¢ */
            /* è¿™é‡Œä¸åŠ  transitionï¼Œä¿è¯æ‰‹æŒ‡æ‹–åŠ¨çš„å®æ—¶è·Ÿæ‰‹æ€§ */
            
            /* æ·»åŠ ä¸€ä¸ªæŠŠæ‰‹æˆ–è€…çº¹ç†ï¼Œå¢åŠ çœŸå®æ„Ÿ */
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 20px;
            color: rgba(255,255,255,0.3);
            font-weight: bold;
            font-size: 20px;
            border-bottom: 10px solid #3e2723;
        }
        
        /* è§¦æ‘¸æ„Ÿåº”åŒº - æ‰©å¤§è§¦æ‘¸èŒƒå›´ */
        #touch-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 999; /* æœ€é«˜å±‚çº§ï¼Œç¡®ä¿èƒ½æ¥æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ */
        }

        /* æ§åˆ¶åŒºå’Œæç¤º */
        .controls {
            margin-top: auto; /*æ¨åˆ°åº•éƒ¨*/
            margin-bottom: 30px;
            text-align: center;
            color: #bdc3c7;
            z-index: 100;
        }

        .btn {
            background-color: #c0392b;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 25px;
            box-shadow: 0 4px 0 #96281b;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #shake-tip {
            font-size: 14px;
            color: #e67e22;
            margin-top: 5px;
        }
        
        /* æ‘‡æ™ƒåŠ¨ç”» - æ›´å‰§çƒˆ */
        @keyframes violent-shake {
            0% { transform: translate(0, 0) rotate(0deg); }
            10%, 90% { transform: translate(-8px, 2px) rotate(-3deg); }
            20%, 80% { transform: translate(10px, -4px) rotate(4deg); }
            30%, 50%, 70% { transform: translate(-15px, 5px) rotate(-5deg); }
            40%, 60% { transform: translate(15px, -5px) rotate(5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        .cup-shaking {
            animation: violent-shake 0.5s ease-in-out;
        }

    </style>
</head>
<body>

    <h1>ğŸ² ä¸“ä¸šå¤§è¯éª°</h1>

    <div id="stage">
        <div id="dice-container">
            </div>
        <div id="dice-cup">
            DYR CASINO
        </div>
    </div>
    
    <div id="touch-area"></div>

    <div class="controls">
        <button class="btn" id="permission-btn">ç‚¹æˆ‘å¼€å¯æ‘‡ä¸€æ‘‡æƒé™ (iOSå¿…ç‚¹)</button>
        <div style="margin-top: 10px;">
             â†‘ ä¸Šæ»‘æ­ç›–ï¼Œâ†“ ä¸‹æ»‘ç›–ä¸Š<br>
             <span id="shake-tip">ç›–ä¸Šç›–å­ï¼Œç”¨åŠ›ç”©åŠ¨æ‰‹æœºæ‘‡éª°ï¼</span>
        </div>
        <br>
        <a href="index.html" style="color: #bdc3c7; text-decoration: none;">â† è¿”å›é¦–é¡µ</a>
    </div>

    <script>
        // --- 1. éª°å­é€»è¾‘é…ç½® ---
        const faceConfig = {
            1: [4], 2: [0, 8], 3: [0, 4, 8], 4: [0, 2, 6, 8], 5: [0, 2, 4, 6, 8], 6: [0, 2, 3, 5, 6, 8]
        };
        const container = document.getElementById('dice-container');
        const cup = document.getElementById('dice-cup');
        const touchArea = document.getElementById('touch-area');
        const permissionBtn = document.getElementById('permission-btn');
        const shakeTip = document.getElementById('shake-tip');

        let diceCount = 5; // å›ºå®š5ä¸ªéª°å­ç©å¤§è¯éª°
        let isShaking = false;
        let isCupOpen = false; // æ¯å­çŠ¶æ€

        // --- 2. æ‘‡ä¸€æ‘‡ç›¸å…³å˜é‡ (å¤§å¹…åº¦ä¿®æ”¹) ---
        // é˜ˆå€¼ä»25æé«˜åˆ°180ï¼Œéœ€è¦å‰§çƒˆæ‘‡æ™ƒ
        let shakeThreshold = 180; 
        let lastX = 0, lastY = 0, lastZ = 0;
        let lastUpdate = 0;
        let hasPermission = false;

        // --- 3. è§¦æ‘¸æ‹–åŠ¨ç›¸å…³å˜é‡ ---
        let startY = 0; // æ‰‹æŒ‡æŒ‰ä¸‹çš„ä½ç½®
        let currentCupY = 0; // æ¯å­å½“å‰çš„Yè½´åç§»é‡
        const maxMoveUp = -200; // æœ€å¤§å‘ä¸Šç§»åŠ¨è·ç¦» (æ­å¼€)
        const minMoveDown = 0; // æœ€å°å‘ä¸‹ç§»åŠ¨è·ç¦» (ç›–ä½)

        // åˆå§‹åŒ–
        createDice();
        initTouchGestures(); // åˆå§‹åŒ–æ‰‹åŠ¿ç›‘å¬

        // --- æ ¸å¿ƒåŠŸèƒ½ A: åˆ›å»ºå’Œç»˜åˆ¶éª°å­ ---
        function createDice() {
            container.innerHTML = '';
            for (let i = 0; i < diceCount; i++) {
                let die = document.createElement('div');
                die.className = 'die';
                // åˆå§‹éšæœºç‚¹æ•°
                drawDots(die, Math.floor(Math.random() * 6) + 1);
                container.appendChild(die);
            }
        }

        function drawDots(dieElement, number) {
            dieElement.innerHTML = '';
            const positions = faceConfig[number];
            for (let i = 0; i < 9; i++) {
                let cell = document.createElement('div');
                if (positions.includes(i)) {
                    let dot = document.createElement('div');
                    dot.className = 'dot';
                    // 1ç‚¹å’Œ4ç‚¹é€šå¸¸æ˜¯çº¢è‰²çš„ï¼Œè¿™é‡Œä¸ºäº†ç»Ÿä¸€é£æ ¼ï¼Œé™¤äº†1ç‚¹å¤§ä¸€ç‚¹å¤–éƒ½ç”¨æ·±çº¢è‰²
                    if (number === 1) {
                        dot.style.width = '14px';
                        dot.style.height = '14px';
                    }
                    cell.appendChild(dot);
                }
                dieElement.appendChild(cell);
            }
        }

        // --- æ ¸å¿ƒåŠŸèƒ½ B: æ‰‹æŒ‡æ»‘åŠ¨æ­ç›– (å…³é”®åŒæ­¥é€»è¾‘) ---
        function initTouchGestures() {
            // æ‰‹æŒ‡æŒ‰ä¸‹
            touchArea.addEventListener('touchstart', function(e) {
                // è®°å½•æ‰‹æŒ‡æŒ‰ä¸‹çš„åˆå§‹Yåæ ‡
                startY = e.touches[0].clientY;
                // è®°å½•æ¯å­å½“å‰å·²ç»åœ¨ä»€ä¹ˆä½ç½®ï¼ˆé˜²æ­¢è·³å˜ï¼‰
                // é€šè¿‡è§£æ transform çŸ©é˜µè·å–å½“å‰çš„ translateY å€¼
                const style = window.getComputedStyle(cup);
                const matrix = new WebKitCSSMatrix(style.transform);
                currentCupY = matrix.m42; 

                // æŒ‰ä¸‹æ—¶ç§»é™¤å¯èƒ½å­˜åœ¨çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œä¿è¯è·Ÿæ‰‹
                cup.style.transition = 'none';
            }, { passive: false });

            // æ‰‹æŒ‡ç§»åŠ¨
            touchArea.addEventListener('touchmove', function(e) {
                e.preventDefault(); // é˜»æ­¢é¡µé¢æ»šåŠ¨
                const touchY = e.touches[0].clientY;
                // è®¡ç®—æ‰‹æŒ‡ç§»åŠ¨çš„è·ç¦»å·®
                const deltaY = touchY - startY;
                // è®¡ç®—æ¯å­åº”è¯¥åœ¨çš„æ–°ä½ç½®
                let newPosY = currentCupY + deltaY;

                // é™åˆ¶ç§»åŠ¨èŒƒå›´ï¼šä¸èƒ½è¶…è¿‡æœ€é«˜ç‚¹ï¼Œä¹Ÿä¸èƒ½ä½äºæœ€ä½ç‚¹
                newPosY = Math.max(maxMoveUp, Math.min(minMoveDown, newPosY));

                // å®æ—¶åº”ç”¨ä½ç½®ç»™æ¯å­
                cup.style.transform = `translateY(${newPosY}px) translateZ(20px)`; // Zè½´è®©å®ƒçœ‹èµ·æ¥æµ®èµ·æ¥ä¸€ç‚¹

                // æ ¹æ®ä½ç½®åˆ¤æ–­æ¯å­æ˜¯å¦æ‰“å¼€
                isCupOpen = newPosY < -100;
            }, { passive: false });

            // æ‰‹æŒ‡æŠ¬èµ· (è‡ªåŠ¨å¸é™„æ•ˆæœ)
            touchArea.addEventListener('touchend', function(e) {
                // åŠ ä¸€ä¸ªè¿‡æ¸¡åŠ¨ç”»ï¼Œè®©å¸é™„è¿‡ç¨‹å¹³æ»‘
                cup.style.transition = 'transform 0.3s ease-out';
                
                const style = window.getComputedStyle(cup);
                const matrix = new WebKitCSSMatrix(style.transform);
                const finalY = matrix.m42;

                // å¦‚æœç§»åŠ¨è¶…è¿‡ä¸€åŠï¼Œå°±è‡ªåŠ¨å…¨å¼€ï¼›å¦åˆ™è‡ªåŠ¨å…¨å…³
                if (finalY < maxMoveUp / 2) {
                    cup.style.transform = `translateY(${maxMoveUp}px) translateZ(20px)`;
                    isCupOpen = true;
                } else {
                    cup.style.transform = `translateY(${minMoveDown}px) translateZ(0px)`;
                    isCupOpen = false;
                }
            });
        }


        // --- æ ¸å¿ƒåŠŸèƒ½ C: æ‘‡ä¸€æ‘‡é€»è¾‘ ---

        // æƒé™æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        permissionBtn.addEventListener('click', function() {
            if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            startListeningShake();
                            permissionBtn.style.display = 'none'; // æˆæƒæˆåŠŸåéšè—æŒ‰é’®
                            shakeTip.innerText = "æ„Ÿåº”å·²å¼€å¯ï¼Œè¯·ç›–ä¸Šç›–å­ç”¨åŠ›ç”©ï¼";
                            hasPermission = true;
                        }
                    })
                    .catch(console.error);
            } else {
                // å®‰å“æˆ–å…¶ä»–ä¸éœ€è¦æˆæƒçš„è®¾å¤‡
                startListeningShake();
                permissionBtn.style.display = 'none';
                hasPermission = true;
            }
        });

        function startListeningShake() {
            window.addEventListener('devicemotion', handleShake);
        }

        function handleShake(event) {
            if (isShaking) return; 
            
            // ã€å…³é”®è§„åˆ™ã€‘åªæœ‰æ¯å­ç›–ä½çš„æ—¶å€™æ‰èƒ½æ‘‡ï¼
            if (isCupOpen) {
                shakeTip.innerText = "è¯·å…ˆå‘ä¸‹æ»‘åŠ¨ç›–ä¸Šæ¯å­å†æ‘‡ï¼";
                shakeTip.style.color = "red";
                setTimeout(() => { shakeTip.style.color = "#e67e22"; }, 2000);
                return;
            }

            let acceleration = event.accelerationIncludingGravity;
            let curTime = new Date().getTime();

            if ((curTime - lastUpdate) > 100) {
                let diffTime = curTime - lastUpdate;
                lastUpdate = curTime;
                let x = acceleration.x; let y = acceleration.y; let z = acceleration.z;
                // è®¡ç®—æ‘‡åŠ¨é€Ÿåº¦
                let speed = Math.abs(x + y + z - lastX - lastY - lastZ) / diffTime * 10000;

                if (speed > shakeThreshold) {
                    performShakeAction();
                }
                lastX = x; lastY = y; lastZ = z;
            }
        }

        function performShakeAction() {
            isShaking = true;
            shakeTip.innerText = "æ‘‡åŠ¨ä¸­...";

            // æ‰‹æœºéœ‡åŠ¨
            if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 100]);

            // æ¯å­æ™ƒåŠ¨åŠ¨ç”»
            cup.classList.add('cup-shaking');

            // åå°æ‚„æ‚„æ”¹å˜éª°å­ç‚¹æ•° (å¤–é¢çœ‹ä¸è§)
            let rollInterval = setInterval(() => {
                const dice = document.querySelectorAll('.die');
                dice.forEach(die => {
                    drawDots(die, Math.floor(Math.random() * 6) + 1);
                    // ç¨å¾®éšæœºè½¬åŠ¨ä¸€ä¸‹éª°å­ï¼Œå¢åŠ çœŸå®æ„Ÿ
                    die.style.transform = `rotate(${Math.random()*360}deg)`;
                });
            }, 100);

            // åœæ­¢æ‘‡åŠ¨
            setTimeout(() => {
                clearInterval(rollInterval);
                cup.classList.remove('cup-shaking');
                shakeTip.innerText = "æ‘‡å¥½äº†ï¼ä¸Šæ»‘æ­æ™“ï¼";
                isShaking = false;
                
                // å®šæ ¼æœ€ç»ˆç‚¹æ•°
                const dice = document.querySelectorAll('.die');
                dice.forEach(die => {
                    drawDots(die, Math.floor(Math.random() * 6) + 1);
                    // é‡ç½®æ—‹è½¬
                    die.style.transform = `rotate(0deg)`;
                });
            }, 1000); // æ‘‡åŠ¨æŒç»­1ç§’
        }

    </script>
</body>
</html>
